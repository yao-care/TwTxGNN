# Source Anchoring Rules Module v1

本模組定義強制來源標註規則，確保所有事實陳述可追溯。

---

## 1. 核心原則

**每一個事實陳述必須附加來源標籤**

這是防止 LLM 產出無根據內容的核心機制。

---

## 2. 正確寫法範例

### 有來源時
```markdown
✅ 正確：
「Minoxidil 可能引起心悸。」[來源：FDA Label 2023, Section 5.1]

「Levamisole 的免疫調節作用與 T 細胞活化相關。」[來源：DrugBank DB00432]

「該試驗顯示主要療效指標達到統計顯著。」[來源：NCT01234567]
```

### 找不到時
```markdown
✅ 正確：
「Minoxidil 心血管風險：**[Data Gap]** 已查 TFDA 仿單（2026-01-14）、FDA DailyMed（2026-01-14），未找到明確記載。」

「DDI 資料：**[未檢索]** Unified DDI 系統尚未整合。」

「機轉關聯性：**[未找到]** 已查 PubMed（2026-01-14，關鍵字：drug AND disease），回傳 0 筆直接相關文獻。」
```

---

## 3. 禁止語句清單

以下語句在**無來源時**禁止使用：

| 禁止語句 | 原因 | 替代寫法 |
|---------|------|---------|
| 「可能」「或許」「應該」 | 模糊推測 | 「根據 {來源}，{陳述}」或標記 [Data Gap] |
| 「一般認為」「通常」 | 無法追溯 | 「根據 {指引/文獻}」 |
| 「據了解」「據報導」 | 來源不明 | 「根據 {具體來源}」 |
| 「建議參考」 | 沒有具體文獻 | 「參考 {具體文獻 PMID/URL}」 |
| 「無」「無風險」「無特別」 | 可能遺漏 | 「**[未找到]** 已查 {來源}，未發現相關記載」 |
| 「安全」「有效」 | 過度肯定 | 「根據 {試驗}，{具體數據}」 |

---

## 4. 來源標籤格式

### 標準格式
```
[來源：{來源類型} {識別碼}]
```

### 常用來源類型
| 來源類型 | 格式範例 |
|---------|---------|
| TFDA 仿單 | [來源：TFDA 仿單 衛署藥輸字第XXXXXX號] |
| FDA Label | [來源：FDA Label 2023, Section X.X] |
| DrugBank | [來源：DrugBank DB00XXX] |
| PubMed | [來源：PMID 12345678] |
| ClinicalTrials | [來源：NCT01234567] |
| WHO | [來源：WHO ICD-10] |
| 指引 | [來源：{學會} {指引名稱} {年份}] |

---

## 5. 來源標註位置

### 句末標註（推薦）
```markdown
Minoxidil 的主要代謝途徑為肝臟葡萄糖醛酸化。[來源：DrugBank DB00350]
```

### 表格內標註
```markdown
| 項目 | 內容 | 來源 |
|------|------|------|
| 半衰期 | 4.2 小時 | DrugBank DB00350 |
| 代謝 | 肝臟 | FDA Label 2023 |
```

### 段落標註
```markdown
根據 FDA Label（2023），Minoxidil 的主要警語包括：
1. 心血管風險 [Section 5.1]
2. 體液滯留 [Section 5.2]
3. 心包膜積液 [Section 5.3]
```

---

## 6. 複合陳述處理

當一個句子包含多個事實時：

### 方式一：多來源標註
```markdown
Minoxidil 原核准用於高血壓[來源：TFDA]，後發現有促進毛髮生長作用[來源：PMID 12345678]。
```

### 方式二：來源區分
```markdown
**藥理特性**（來源：DrugBank DB00350）：
- 機轉：血管擴張
- 半衰期：4.2 小時

**臨床發現**（來源：PMID 12345678）：
- 促進毛髮生長
- 延長毛髮生長期
```

---

## 7. 推論與假設的標註

### 基於證據的推論
```markdown
基於 Minoxidil 的血管擴張機轉[來源：DrugBank DB00350]，
**推論**：可能對其他血管相關疾病有潛在作用。
**限制**：此為機轉推論，非直接證據。
```

### 保守假設
```markdown
**假設**：由於缺乏 TFDA 仿單資料[Data Gap #1]，
暫時假設其安全性警語與 FDA Label 一致。
**依據**：同成分藥物
**觸發更新**：取得 TFDA 仿單後
```

---

## 8. 驗證規則

在輸出報告前，必須檢查：

1. **無孤立陳述**：每個事實陳述都有來源
2. **無禁止語句**：未使用禁止清單中的語句（無來源情況）
3. **Data Gap 標記完整**：所有缺失資料都有明確標記
4. **來源格式一致**：使用統一的來源標籤格式

---

## 9. 自動檢查清單

```python
# 檢查禁止語句（無來源時）
FORBIDDEN_WITHOUT_SOURCE = [
    "可能", "或許", "應該",
    "一般認為", "通常", "據了解",
    "建議參考", "無特別", "無風險"
]

# 檢查必要來源標記
REQUIRED_SOURCE_PATTERNS = [
    r"\[來源：.*?\]",
    r"\[Data Gap\]",
    r"\[未檢索\]",
    r"\[未找到\]",
    r"\[不適用\]"
]
```
